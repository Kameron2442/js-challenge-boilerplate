<div class="main-container main-container--flex">
    <h1 class="main-container__title">OCR File Upload</h1>
    <h2 class="main-container__description">Use the button below to upload a .csv file and view the contents</h2>
    <p class="main-container__total-files">Total files stored: {{policyStore.uploadCount()}}</p>

    <div class="file-upload">
        <label 
            #inputLabel 
            for="fileUpload" 
            class="btn" 
            tabindex="0" 
            role="button" 
            (keyup.enter)="clickLabel()" 
            (keyup.space)="clickLabel()" 
            [class.btn--disabled]="policyStore.uploadProcessing()">
            <span class="file-upload__icon material-symbols-outlined" aria-hidden="true">upload_file</span>
            {{policyStore.uploadProcessing() ? 'Processing' : 'Choose File'}}
        </label>
        <input
            #csvInput
            id="fileUpload" 
            class="file-upload__input" 
            type="file" 
            accept=".csv" 
            aria-hidden="true"
            (change)="uploadCsv($event)" 
            (click)="clearSelection($event)"/>
    </div>

    @if (policyStore.uploadError()) {
        <div class="error-banner" role="alert" animate.enter="enter-animation">
            <span class="error-banner__icon material-symbols-outlined" aria-hidden="true">error</span>
            {{policyStore.uploadError()}}
        </div>
    } 

    <div aria-live="polite">
        @for (item of policyStore.homePolicyUploads(); track item.id) {
            <table class="csv-table" animate.enter="enter-animation">
                <caption class="csv-table__title">File #{{item.id}}: CSV data table from {{item.fileName}}</caption>
                <thead>
                    <tr>
                        <th scope="col">Count</th>
                        <th scope="col">Policy #</th>
                        <th scope="col">Result</th>
                    </tr>
                </thead>
                <tbody>
                    @for (item of item.homePolicies; track item.id) {
                        <tr class="csv-table__rows">
                            <td class="csv-table__id">{{item.id}}</td>
                            <td class="csv-table__number">{{item.policyNumber}}</td>
                            <td class="csv-table__valid">{{item.valid}}</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
    

</div>